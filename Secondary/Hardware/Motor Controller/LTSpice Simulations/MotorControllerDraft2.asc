Version 4
SHEET 1 3412 2020
WIRE 1472 16 1296 16
WIRE 1600 16 1552 16
WIRE 1712 16 1600 16
WIRE 432 32 64 32
WIRE 848 32 432 32
WIRE 432 64 432 32
WIRE 848 64 848 32
WIRE 1600 96 1600 16
WIRE 1712 96 1712 16
WIRE 64 144 64 32
WIRE 288 144 272 144
WIRE 384 144 368 144
WIRE 704 144 688 144
WIRE 800 144 784 144
WIRE 432 192 432 160
WIRE 512 192 432 192
WIRE 848 192 848 160
WIRE 928 192 848 192
WIRE 432 224 432 192
WIRE 848 224 848 192
WIRE 1600 256 1600 160
WIRE 1600 256 1296 256
WIRE 1712 256 1712 176
WIRE 1712 256 1600 256
WIRE 288 304 272 304
WIRE 384 304 368 304
WIRE 704 304 688 304
WIRE 800 304 784 304
WIRE 64 368 64 224
WIRE 432 368 432 320
WIRE 432 368 64 368
WIRE 848 368 848 320
WIRE 848 368 432 368
WIRE 432 384 432 368
WIRE 1792 608 1744 608
WIRE 1920 608 1856 608
WIRE 1744 704 1744 608
WIRE 1792 704 1744 704
WIRE 1920 704 1920 608
WIRE 1920 704 1872 704
WIRE -144 720 -160 720
WIRE -32 720 -144 720
WIRE 64 720 32 720
WIRE 112 720 64 720
WIRE 320 720 176 720
WIRE 480 720 464 720
WIRE 592 720 480 720
WIRE 688 720 656 720
WIRE 736 720 688 720
WIRE 944 720 800 720
WIRE 64 768 64 720
WIRE 688 768 688 720
WIRE 1552 768 1312 768
WIRE 1744 768 1744 704
WIRE 1744 768 1632 768
WIRE 1744 816 1744 768
WIRE 1792 816 1744 816
WIRE -144 832 -144 720
WIRE -64 832 -144 832
WIRE 208 832 192 832
WIRE 480 832 480 720
WIRE 560 832 480 832
WIRE 832 832 816 832
WIRE 1920 832 1920 704
WIRE 1920 832 1856 832
WIRE 2080 832 1920 832
WIRE 2224 832 2160 832
WIRE 2320 832 2224 832
WIRE 1792 848 1744 848
WIRE 2224 880 2224 832
WIRE -64 912 -176 912
WIRE 320 912 320 720
WIRE 320 912 192 912
WIRE 352 912 320 912
WIRE 560 912 448 912
WIRE 944 912 944 720
WIRE 944 912 816 912
WIRE 976 912 944 912
WIRE -64 928 -64 912
WIRE 1536 960 1296 960
WIRE 1744 960 1744 848
WIRE 1744 960 1616 960
WIRE 1824 960 1744 960
WIRE -176 992 -176 912
WIRE -160 992 -176 992
WIRE -80 992 -96 992
WIRE -64 992 -80 992
WIRE 208 992 192 992
WIRE 448 992 448 912
WIRE 464 992 448 992
WIRE 544 992 528 992
WIRE 560 992 544 992
WIRE 832 992 816 992
WIRE -80 1008 -80 992
WIRE 544 1008 544 992
WIRE 1744 1008 1744 960
WIRE 1824 1008 1824 960
WIRE 2224 1008 2224 944
WIRE -176 1024 -176 992
WIRE 448 1024 448 992
WIRE 64 1072 64 1056
WIRE 688 1072 688 1056
WIRE 1744 1120 1744 1088
WIRE 1824 1120 1824 1072
WIRE 1824 1120 1744 1120
WIRE 1744 1136 1744 1120
WIRE -496 1584 -496 1552
WIRE -256 1616 -400 1616
WIRE -400 1680 -400 1616
WIRE -384 1680 -400 1680
WIRE -256 1696 -256 1616
WIRE -256 1696 -320 1696
WIRE -192 1696 -256 1696
WIRE -496 1712 -496 1664
WIRE -384 1712 -496 1712
WIRE -496 1792 -496 1712
WIRE -496 1904 -496 1872
FLAG 272 144 drive1H
FLAG 272 304 drive1L
FLAG 688 144 drive2H
FLAG 688 304 drive2L
FLAG 208 832 drive1H
FLAG 208 992 drive1L
FLAG 832 832 drive2H
FLAG 832 992 drive2L
FLAG 352 912 Vleft
FLAG 432 384 0
FLAG 64 1072 0
FLAG 688 1072 0
FLAG 976 912 Vright
FLAG -1168 752 drive1pwm
FLAG -1168 1008 drive2pwm
FLAG -1168 832 0
FLAG -1168 1088 0
FLAG -176 1024 drive1pwm
FLAG 448 1024 drive2pwm
FLAG -880 464 0
FLAG -880 384 Vcc
FLAG -160 720 Vcc
FLAG 464 720 Vcc
FLAG 512 192 Vleft
FLAG 928 192 Vright
FLAG 1824 800 Vcc
FLAG 1312 768 Vright
FLAG 1296 960 Vleft
FLAG -880 1712 0
FLAG -880 1632 5V
FLAG -496 1552 5V
FLAG -496 1904 0
FLAG -352 1664 5V
FLAG -352 1728 0
FLAG -192 1696 2V5
FLAG 1296 16 Vleft
FLAG 1296 256 Vright
FLAG 1824 864 0
FLAG 1744 1136 2V5
FLAG 2224 1008 0
FLAG 2320 832 Vmotor
SYMBOL voltage 64 128 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Vin
SYMATTR Value 4V
SYMBOL nmos 384 64 R0
SYMATTR InstName M1
SYMATTR Value Si7336ADP
SYMBOL nmos 384 224 R0
SYMATTR InstName M2
SYMATTR Value Si7336ADP
SYMBOL nmos 800 64 R0
SYMATTR InstName M3
SYMATTR Value Si7336ADP
SYMBOL nmos 800 224 R0
SYMATTR InstName M4
SYMATTR Value Si7336ADP
SYMBOL PowerProducts\\LTC4444 64 912 R0
SYMATTR InstName U1
SYMBOL PowerProducts\\LTC4444 688 912 R0
SYMATTR InstName U2
SYMBOL cap 176 704 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C1
SYMATTR Value 1µF
SYMBOL diode -32 736 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMATTR Value 1N914
SYMBOL diode 592 736 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D2
SYMATTR Value 1N914
SYMBOL cap 800 704 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value 1µF
SYMBOL Digital\\inv -160 928 R0
SYMATTR InstName A1
SYMATTR SpiceLine Vhigh=5V,Td=5e-9,Trise=20e-9
SYMBOL Digital\\inv 464 928 R0
SYMATTR InstName A2
SYMATTR SpiceLine Vhigh=5V,Td=5e-9,Trise=20e-9
SYMBOL voltage -1168 736 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName drive1pwm
SYMATTR Value PULSE(0 5 0 10n 10n {positive_dutycycle*period} {period})
SYMBOL voltage -1168 992 R0
WINDOW 3 25 90 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE(0 5 {theta} 10n 10n {negative_dutycycle*period} {period})
SYMATTR InstName drive2pwm
SYMBOL voltage -880 368 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Vcc
SYMATTR Value 10V
SYMBOL res 384 128 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 10
SYMBOL res 384 288 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 10
SYMBOL res 800 128 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 10
SYMBOL res 800 288 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 10
SYMBOL res 1648 752 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rf
SYMATTR Value {Rf}
SYMBOL res 1632 944 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value {Rf}
SYMBOL res 1888 688 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value {Rf}
SYMBOL res 1760 1104 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R7
SYMATTR Value {Rf}
SYMBOL cap 1808 1008 R0
SYMATTR InstName C3
SYMATTR Value {Cf}
SYMBOL cap 1856 592 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C4
SYMATTR Value {Cf}
SYMBOL OpAmps\\UniversalOpamp2 1824 832 R0
SYMATTR InstName U4
SYMBOL voltage -880 1616 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 5
SYMBOL OpAmps\\UniversalOpamp2 -352 1696 R0
SYMATTR InstName U3
SYMBOL res -512 1568 R0
SYMATTR InstName R8
SYMATTR Value 10k
SYMBOL res -512 1776 R0
SYMATTR InstName R9
SYMATTR Value 10k
SYMBOL res 2176 816 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value {Rf}
SYMBOL cap 2208 880 R0
SYMATTR InstName C5
SYMATTR Value {Cf}
SYMBOL ind 1456 32 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 10µ
SYMBOL cap 1584 96 R0
SYMATTR InstName C6
SYMATTR Value 10µ
SYMBOL res 1696 80 R0
SYMATTR InstName R10
SYMATTR Value 50
TEXT -144 616 Left 3 ;Bootstrap Drivers
TEXT 72 -48 Left 3 ;MOSFET Full-bridge inverter
TEXT -216 184 Left 2 ;4V <= Vin <= 10V
TEXT -1096 152 Left 2 !.tran 10m
TEXT -1176 1240 Left 2 !.param theta = 5u
TEXT -1176 1168 Left 2 !.param positive_dutycycle=0 negative_dutycycle=0.5
TEXT -1176 1304 Left 2 ;Change params positive_dutycycle and negative_dutycycle \nas needed to simulate pwm signal
TEXT 1216 512 Left 3 ;Voltage sensing, filtering and conditioning circuit. Converts PWM signal of motor to a low ripple DC voltage suitable for sensing by the ADC.
TEXT -1088 1552 Left 2 ;5V power supply for microcontroller
TEXT -560 1496 Left 2 ;2.5V offset for voltage sensing
TEXT 1208 -48 Left 2 ;Driving the motor
TEXT 2496 704 Left 2 !.param Rf = 10k
TEXT 2496 744 Left 2 !.param Cf = 10n
TEXT 2496 664 Left 2 ;Filter resistance and capacitance values
TEXT 1704 -8 Left 2 ;Motor
TEXT 1376 296 Left 2 ;Note that L, R, and C are arbitrary values.
TEXT -920 1240 Left 2 !.param period = 10u
TEXT -1200 288 Left 2 ;Power supply for bootstrap drivers and differential amplifier.
LINE Normal -128 1968 -128 1488 2
LINE Normal -576 1968 -128 1968 2
LINE Normal -592 1968 -576 1968 2
LINE Normal -592 1488 -592 1968 2
LINE Normal -592 1456 -592 1488 2
LINE Normal -128 1456 -592 1456 2
LINE Normal -128 1504 -128 1456 2
RECTANGLE Normal -272 -80 1088 480 2
RECTANGLE Normal 1120 1184 -288 576 2
RECTANGLE Normal 3408 1216 1168 480 2
RECTANGLE Normal -624 1792 -1152 1456 2
RECTANGLE Normal 1792 208 1440 -32 2
RECTANGLE Normal 1888 352 1184 -80 2
RECTANGLE Normal -320 1376 -1216 608 2
RECTANGLE Normal -448 528 -1216 240 2
